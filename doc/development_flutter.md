# OmniScan: Comprehensive Flutter Development Framework (for LLM Agent)

## 1. üéØ Core Objectives & Principles

This document provides a comprehensive, modular, and state-independent framework to guide a Large Language Model (LLM) Agent in developing the OmniScan app for both Android and iOS using the Flutter framework.

**Core Principles:**

* **Decoupling from Context:** Every agent action must be based on the instructions within this framework, not on conversational history.
* **Modularity & Single Responsibility:** The system is broken down into independent layers and components. The agent will build one component at a time.
* **Local-First Architecture:** The application must function perfectly offline. All user actions should be fast and responsive.
* **Scalability:** The architecture is designed to perfectly support a local-only implementation, while being ready for future expansion without major refactoring of the core application logic.

## 2. üèõÔ∏è System Architecture

The agent must structure the application according to the following architecture, which combines the Repository Pattern, Provider for state management, and `go_router` for navigation.

### 2.1 Architectural Diagram

```mermaid
graph TD
    subgraph "Presentation Layer (UI)"
        Widget[Widgets]
        Screen[Screens]
    end

    subgraph "State Management Layer"
        Provider[AppStateProvider]
    end
    
    subgraph "Domain Layer (Business Logic)"
        RepositoryAbs(ScanItemRepository);
    end

    subgraph "Data Layer"
        RepoImpl[LocalScanItemRepository]
        LocalDS[LocalDataSource -- Isar DB]
    end

    Screen --> Provider;
    Widget --> Provider;
    Provider --> RepositoryAbs;
    
    RepositoryAbs <|.. RepoImpl;
    RepoImpl --> LocalDS;
```

### 2.2 Directory Structure

The agent must create and maintain the following directory structure inside the `lib/` folder:

```
lib/
|-- main.dart
|-- core/
|   |-- config/               # Environment configuration & Theming
|   |-- constants/            # App constants (Colors, Font Sizes)
|   `-- services/
|       |-- navigation_service.dart # GoRouter configuration
|       `-- service_locator.dart    # Dependency injection setup
|-- data/
|   |-- sources/
|   |   `-- local_data_source.dart  # Isar implementation
|   |-- repositories/
|   |   `-- scan_item_repository_impl.dart # Local repository implementation
|   `-- models/
|       `-- scan_item.dart        # Core data models for Isar
|-- domain/
|   |-- repositories/
|   |   `-- scan_item_repository.dart # Abstract repository interface
|   `-- entities/               # Pure business logic entities (if needed)
`-- presentation/
    |-- providers/
    |   `-- app_state_provider.dart
    |-- screens/
    |   |-- splash_screen.dart
    |   `-- ... (other screens)
    `-- widgets/
        `-- ... (reusable widgets)
```

## 3. üíæ Data & Storage Architecture

### 3.1 Data Models (Isar Schema)

The local database (Isar) will use these Dart classes as its schema. Annotate them exactly as specified.

```dart
// In data/models/scan_item.dart

import 'package:isar/isar.dart';
part 'scan_item.g.dart'; // To be generated by Isar build_runner

@collection
class ScanItem {
  Id id = Isar.autoIncrement;
  @Index()
  late DateTime createdAt;
  late DateTime updatedAt;
  late String originalImagePath;
  String? userTitle;
  List<String> userTags = [];
  String? userNotes;
  final analysis = IsarLink<LLMAnalysisResult>();
}

@collection
class LLMAnalysisResult {
  Id id = Isar.autoIncrement;
  late String suggestedTitle;
  late String summary;
  @Index(type: IndexType.value)
  @Enumerated(EnumType.name)
  late DetectedCategory category;
  @Index(type: IndexType.fullText) // Enable full-text search on raw text
  String? rawText;
  List<ExtractedField> extractedFields = [];
  List<String> suggestedTags = [];
  List<SuggestedAction> suggestedActions = [];
}

@embedded
class ExtractedField {
  String? key;
  String? value;
}

@embedded
class SuggestedAction {
  String? actionType;
  String? description;
  String? payloadJson; // Store the payload map as a JSON string
}

enum DetectedCategory { BusinessCard, Receipt, Document, Note, Other }
```

### 3.2 Storage Strategy: Local-First

The application will operate on a local-first basis. All data operations (Reads and Writes) are performed directly on the local Isar database, ensuring maximum performance and full offline capability.

## 4. ‚òÅÔ∏è Backend API & LLM Strategy

For this local-only version, the interaction with a backend API will be simulated. The complexity of LLM processing is handled by a mock service that mimics the behavior of a real backend.

### 4.1 Mock LLM Strategy

A `MockLlmService` will be created to simulate fetching a structured response. This service will:

1.  Conceptually accept an image.
2.  Use `Future.delayed` for a simulated delay.
3.  Return a hardcoded, structured JSON object that conforms to the API contract.

### 4.2 API Contract: LLM Structured Response

The mock service **MUST** return an object that can be serialized into a JSON matching the format below. This ensures that when a real backend is introduced later, the data contract remains consistent.

**Base JSON Schema:**

```json
{
  "category": "string (e.g., 'BusinessCard')",
  "suggestedTitle": "string",
  "summary": "string",
  "rawText": "string",
  "extractedFields": [{"key": "string", "value": "string", "type": "string"}],
  "suggestedTags": ["string"],
  "suggestedActions": [{"actionType": "string", "description": "string", "payload": {"key": "value"}}]
}
```

## 5. üé® Presentation Layer: UI/UX Design System

This section defines the visual language and interaction patterns for the application. All UI components must be built following these specifications.

### 5.1 Design Philosophy: Intelligent Minimalism

The style should be clean, modern, and trustworthy. Use generous white space, a clear visual hierarchy, and subtle animations to create an efficient and delightful experience.

### 5.2 Core Visual Elements

#### **Color Palette**

* **Primary:** `Color(0xFF3B82F6)` (Tech Blue - for primary buttons, icons, accents)
* **Background:** `Color(0xFFF0F4F8)` (Light Gray-Blue - for app backgrounds)
* **Surface:** `Color(0xFFFFFFFF)` (White - for card, dialog backgrounds)
* **Text Primary:** `Color(0xFF1F2937)` (Dark Gray - for titles and primary text)
* **Text Secondary:** `Color(0xFF6B7280)` (Medium Gray - for secondary info, hint text)
* **Accent/Success:** `Color(0xFF10B981)` (Green - for success indicators)
* **Accent/Info:** `Color(0xFFF59E0B)` (Amber - for LLM insight sections)

#### **Typography**

* **Font Family:** 'Inter' (or system default sans-serif if not available)
* **Display Large:** `fontSize: 28, fontWeight: FontWeight.bold` (for main screen titles)
* **Headline Small:** `fontSize: 22, fontWeight: FontWeight.bold` (for section titles)
* **Body Large:** `fontSize: 16, fontWeight: FontWeight.normal` (for primary body text)
* **Body Medium:** `fontSize: 14, fontWeight: FontWeight.normal` (for card text, secondary text)
* **Label Small:** `fontSize: 12, fontWeight: FontWeight.w500` (for tags, button text)

#### **Iconography**

* **Library:** `font_awesome_flutter`
* **Size:** Standard size is `20.0`, bottom navigation bar icons are `22.0`.

### 5.3 Core Component Design

#### **`ItemCard`**

* **Container:** `BoxDecoration`
    * `color`: `AppColors.surface`
    * `borderRadius`: `BorderRadius.circular(16.0)`
    * `boxShadow`: `[BoxShadow(color: Colors.black.withOpacity(0.08), blurRadius: 12, offset: Offset(0, 4))]`
* **Layout:** `Column`
    * **Image:** Occupies the top half of the card, using `ClipRRect` with `BorderRadius.vertical(top: Radius.circular(16.0))`.
    * **Padding:** Content area uses `EdgeInsets.all(12.0)`.
    * **Text:** `suggestedTitle` uses `BodyMedium` with `FontWeight.bold`, while `summary` or date uses `LabelSmall` with `TextSecondary` color.

#### **`ScanFab` (Scan Floating Action Button)**

* **Widget:** `FloatingActionButton`
* `backgroundColor`: `AppColors.primary`
* `foregroundColor`: `Colors.white`
* `elevation`: `8.0`
* `shape`: `RoundedRectangleBorder(borderRadius: BorderRadius.circular(24.0))`
* `child`: `FaIcon(FontAwesomeIcons.camera, size: 24)`

#### **`CategoryChip`**

* **Widget:** `Chip`
* `backgroundColor`: `AppColors.primary.withOpacity(0.1)`
* `labelStyle`: `LabelSmall` with `AppColors.primary` color.
* `padding`: `EdgeInsets.symmetric(horizontal: 12, vertical: 8)`

#### **Screen Layouts**

* **`HomeScreen`:**
    * Use `CustomScrollView` with `Slivers` to achieve a collapsible header effect.
    * A `SliverAppBar` displays a greeting and a search field.
    * A `SliverPadding` with a `SliverGrid` is used to display the `ItemCard`s.
* **`ItemDetailScreen`:**
    * Use a `Scaffold` with a standard `AppBar`.
    * The body content should use a `ListView` or a `Column` wrapped in a `SingleChildScrollView`.
    * Each information block (e.g., "Extracted Info," "LLM Insights") should be a separate card-like widget with its own title and padding.

## 6. ‚úÖ Implementation Plan

The Agent must execute these tasks sequentially to build the fully functional, local-only app.

1.  **\[TODO] `Project Setup`**: Create the Flutter project, add dependencies (`isar`, `isar_flutter_libs`, `provider`, `go_router`, `path_provider`, `font_awesome_flutter`), and dev dependencies (`build_runner`, `isar_generator`). Create the specified directory structure.
2.  **\[TODO] `Core Configuration`**:
    * [ ] In `core/constants/`, define `AppColors` and `AppTextStyles` classes.
    * [ ] In `core/config/`, define `AppTheme`, set up `ThemeData`, and apply these colors and text styles.
3.  **\[TODO] `Data Layer (Local)`**:
    * [ ] In `data/models/`, create the Isar data model files as defined in section 3.1.
    * [ ] Run the `build_runner` command to generate the `.g.dart` files.
    * [ ] Create `data/sources/local_data_source.dart`. Implement methods to `save`, `get`, `getAll`, and `delete` `ScanItem` objects using the Isar instance.
4.  **\[TODO] `Domain Layer`**:
    * [ ] Create `domain/repositories/scan_item_repository.dart`. Define the abstract class `ScanItemRepository` with methods like `Future<void> saveItem(ScanItem item)`, `Future<ScanItem?> getItem(int id)`, `Stream<List<ScanItem>> getAllItemsStream()`.
5.  **\[TODO] `Data Layer (Repository Implementation)`**:
    * [ ] Create `data/repositories/scan_item_repository_impl.dart`.
    * [ ] Make it `implement ScanItemRepository`.
    * [ ] It should take a `LocalDataSource` in its constructor and call the corresponding `LocalDataSource` methods.
6.  **\[TODO] `Dependency Injection & State Management`**:
    * [ ] In `main.dart` (or a service locator file), initialize Isar.
    * [ ] Set up `Provider` to provide an instance of `ScanItemRepositoryImpl` to the app.
    * [ ] Create `presentation/providers/app_state_provider.dart`. It should take `ScanItemRepository` in its constructor and use it to fetch and modify data. It will also contain the logic to call the mock LLM service.
7.  **\[TODO] `Presentation Layer (UI & Navigation)`**:
    * [ ] **Create Components:** In `presentation/widgets/`, create reusable components like `ItemCard`, `ScanFab`, etc., according to the specifications in section 5.3.
    * [ ] **Set up Navigation:** Implement the navigation logic using `go_router` in `core/services/navigation_service.dart`.
    * [ ] **Build Screens:** Create all screens (`SplashScreen`, `HomeScreen`, `ItemDetailScreen`, etc.). The UI should get all its state from and dispatch all its actions to `AppStateProvider`.

